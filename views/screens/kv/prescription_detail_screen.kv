#:import utils kivy.utils
#:import dp kivy.metrics.dp

<MedicineDetailCard>:
    orientation: 'vertical'
    size_hint_y: None
    height: dp(180)
    md_bg_color: utils.get_color_from_hex('#FCFCFD')
    radius: [10]
    elevation: 0
    padding: dp(16)
    spacing: dp(12)

    # Medicine Name Header
    BoxLayout:
        size_hint_y: None
        height: dp(32)
        spacing: dp(8)

        MDIcon:
            icon: 'medication'
            size_hint: None, None
            size: dp(24), dp(24)
            color: utils.get_color_from_hex('#344054')
            pos_hint: {'center_y': 0.5}

        MDLabel:
            text: root.medicine_name
            font_size: sp(16)
            font_name: 'Roboto'
            bold: True
            color: utils.get_color_from_hex('#344054')

    # Medicine Details Grid
    GridLayout:
        cols: 2
        spacing: dp(16)
        padding: [dp(8), 0, 0, 0]
        size_hint_y: None
        height: dp(100)

        # Left Column
        BoxLayout:
            orientation: 'vertical'
            spacing: dp(8)

            # Usage Time
            BoxLayout:
                orientation: 'vertical'
                spacing: dp(4)
                
                MDLabel:
                    text: "Thời gian uống"
                    font_size: sp(13)
                    font_name: 'Roboto'
                    bold: True
                    color: utils.get_color_from_hex('#667085')
                    size_hint_y: None
                    height: dp(20)

                MDLabel:
                    text: root.usage_time
                    font_size: sp(14)
                    font_name: 'Roboto'
                    color: utils.get_color_from_hex('#344054')
                    size_hint_y: None
                    height: dp(20)

            # Quantity per time
            BoxLayout:
                orientation: 'vertical'
                spacing: dp(4)

                MDLabel:
                    text: "Liều dùng"
                    font_size: sp(13)
                    font_name: 'Roboto'
                    bold: True
                    color: utils.get_color_from_hex('#667085')
                    size_hint_y: None
                    height: dp(20)

                MDLabel:
                    text: root.quantity_per_time + " viên/lần" if root.quantity_per_time else ""
                    font_size: sp(14)
                    font_name: 'Roboto'
                    color: utils.get_color_from_hex('#344054')
                    size_hint_y: None
                    height: dp(20)

        # Right Column
        BoxLayout:
            orientation: 'vertical'
            spacing: dp(8)

            # Total Quantity
            BoxLayout:
                orientation: 'vertical'
                spacing: dp(4)

                MDLabel:
                    text: "Tổng số lượng"
                    font_size: sp(13)
                    font_name: 'Roboto'
                    bold: True
                    color: utils.get_color_from_hex('#667085')
                    size_hint_y: None
                    height: dp(20)

                MDLabel:
                    text: root.total_quantity + " viên" if root.total_quantity else ""
                    font_size: sp(14)
                    font_name: 'Roboto'
                    color: utils.get_color_from_hex('#344054')
                    size_hint_y: None
                    height: dp(20)

            # Duration
            BoxLayout:
                orientation: 'vertical'
                spacing: dp(4)

                MDLabel:
                    text: "Thời gian điều trị"
                    font_size: sp(13)
                    font_name: 'Roboto'
                    bold: True
                    color: utils.get_color_from_hex('#667085')
                    size_hint_y: None
                    height: dp(20)

                MDLabel:
                    text: root.duration_days + " ngày" if root.duration_days else ""
                    font_size: sp(14)
                    font_name: 'Roboto'
                    color: utils.get_color_from_hex('#344054')
                    size_hint_y: None
                    height: dp(24)

    # Usage Instructions
    BoxLayout:
        orientation: 'vertical'
        spacing: dp(4)
        size_hint_y: None
        height: dp(60)

        MDLabel:
            text: "Hướng dẫn sử dụng"
            font_size: sp(13)
            font_name: 'Roboto'
            bold: True
            color: utils.get_color_from_hex('#667085')
            size_hint_y: None
            height: dp(20)

        MDLabel:
            text: root.usage_instruction
            font_size: sp(14)
            font_name: 'Roboto'
            color: utils.get_color_from_hex('#344054')
            size_hint_y: None
            height: dp(40)

<PrescriptionDetailScreen>:
    BoxLayout:
        orientation: 'vertical'
        canvas.before:
            Color:
                rgba: utils.get_color_from_hex('#F8F9FC')
            Rectangle:
                pos: self.pos
                size: self.size

        # Header with back button
        MDTopAppBar:
            title: "Chi tiết đơn thuốc"
            elevation: 0
            left_action_items: [["arrow-left", lambda x: root.go_back()]]
            md_bg_color: utils.get_color_from_hex('#FFFFFF')
            specific_text_color: utils.get_color_from_hex('#344054')

        ScrollView:
            do_scroll_x: False
            
            BoxLayout:
                orientation: 'vertical'
                size_hint_y: None
                height: self.minimum_height
                padding: dp(16)
                spacing: dp(16)

                # Prescription Info Card
                MDCard:
                    orientation: 'vertical'
                    size_hint_y: None
                    height: dp(140)
                    md_bg_color: utils.get_color_from_hex('#FFFFFF')
                    radius: [16]
                    elevation: 1
                    padding: dp(16)
                    spacing: dp(12)

                    MDLabel:
                        text: 'Thông tin đơn thuốc'
                        font_size: sp(16)
                        font_name: 'Roboto'
                        bold: True
                        color: utils.get_color_from_hex('#344054')
                        size_hint_y: None
                        height: dp(24)

                    MDLabel:
                        id: prescription_name
                        font_size: sp(18)
                        font_name: 'Roboto'
                        bold: True
                        color: utils.get_color_from_hex('#344054')
                        size_hint_y: None
                        height: dp(28)

                    # Hospital Info
                    BoxLayout:
                        size_hint_y: None
                        height: dp(24)
                        spacing: dp(8)

                        MDIcon:
                            icon: 'hospital-building'
                            size_hint: None, None
                            size: dp(20), dp(20)
                            color: utils.get_color_from_hex('#667085')
                            pos_hint: {'center_y': 0.5}

                        MDLabel:
                            id: hospital_name
                            font_size: sp(14)
                            font_name: 'Roboto'
                            color: utils.get_color_from_hex('#667085')

                    # Date Info
                    BoxLayout:
                        size_hint_y: None
                        height: dp(24)
                        spacing: dp(8)

                        MDIcon:
                            icon: 'calendar'
                            size_hint: None, None
                            size: dp(20), dp(20)
                            color: utils.get_color_from_hex('#667085')
                            pos_hint: {'center_y': 0.5}

                        MDLabel:
                            id: created_date
                            font_size: sp(14)
                            font_name: 'Roboto'
                            color: utils.get_color_from_hex('#667085')

                # Medicine List Card
                MDCard:
                    orientation: 'vertical'
                    size_hint_y: None
                    height: medicines_layout.height + dp(60)
                    md_bg_color: utils.get_color_from_hex('#FFFFFF')
                    radius: [16]
                    elevation: 1
                    padding: dp(16)
                    spacing: dp(16)

                    # Medicine List Header
                    BoxLayout:
                        size_hint_y: None
                        height: dp(28)
                        spacing: dp(8)

                        MDIcon:
                            icon: 'pill'
                            size_hint: None, None
                            size: dp(24), dp(24)
                            color: utils.get_color_from_hex('#344054')
                            pos_hint: {'center_y': 0.5}

                        MDLabel:
                            text: 'Danh sách thuốc'
                            font_size: sp(16)
                            font_name: 'Roboto'
                            bold: True
                            color: utils.get_color_from_hex('#344054')

                    # Medicines List
                    BoxLayout:
                        id: medicines_layout
                        orientation: 'vertical'
                        size_hint_y: None
                        height: self.minimum_height
                        spacing: dp(12) 